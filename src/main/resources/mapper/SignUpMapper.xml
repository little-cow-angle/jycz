<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="gene.recombine.stuhubsys.mapper.SignUpMapper">
    <update id="recruit">
        UPDATE sign_up_record s1
            JOIN (SELECT student_id FROM sign_up_record WHERE id = #{id}) s2
            ON s1.student_id = s2.student_id
        SET s1.status = CASE
                            WHEN s1.id = #{id} THEN 2
                            ELSE 3
            END,
            update_time=now();
    </update>


    <select id="selectSignUpPage" resultType="gene.recombine.stuhubsys.dto.SignUpRecordDTO">
        SELECT * FROM sign_up_record
        WHERE ep_id = #{epId}
    </select>

    <select id="getHotMajorSignUpList" resultType="java.util.Map">
        SELECT m.major_name, COUNT(s.ep_id) AS count
        FROM sign_up_record s
        JOIN enrollment_plan e ON s.ep_id = e.id
        JOIN major m ON e.major_id = m.major_id
        GROUP BY m.major_name
        ORDER BY count DESC
        LIMIT 10
    </select>
</mapper>
